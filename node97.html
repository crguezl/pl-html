<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Getting Started</TITLE>
<META NAME="description" CONTENT="Getting Started">
<META NAME="keywords" CONTENT="javascriptexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node98.html">
<LINK REL="previous" HREF="node96.html">
<LINK REL="up" HREF="node96.html">
<LINK REL="next" HREF="node98.html">
</HEAD>

<BODY >

<DIV CLASS="navigation">
<A NAME="tex2html2730"
  HREF="node98.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2724"
  HREF="node96.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2718"
  HREF="node96.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2726"
  HREF="node100.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2728"
  HREF="node103.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/perlexamples/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="Apuntes de LPP"></A><A NAME="tex2html3"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5669"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2014/2015"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2013/2014"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="https://plus.google.com/u/0/communities/103299470687051533933"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1415"></A><A NAME="tex2html7"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html8"
  HREF="http://www.ull.es/view/centros/etsii/Grado_en_Ingenieria_Informatica/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html9"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html10"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2731"
  HREF="node98.html">Porting to Coffeescript</A>
<B>Sup:</B> <A NAME="tex2html2725"
  HREF="node96.html">CoffeeScript y Express</A>
<B> Ant:</B> <A NAME="tex2html2719"
  HREF="node96.html">CoffeeScript y Express</A>
<B> Con:</B> 
<A NAME="tex2html2726"
  HREF="node100.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>
<B> Ind:</B> 
<A NAME="tex2html2728"
  HREF="node103.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html2732"
  HREF="node97.html#SECTION06210010000000000000">Express generator</A>
<LI><A NAME="tex2html2733"
  HREF="node97.html#SECTION06210020000000000000">package.json</A>
<LI><A NAME="tex2html2734"
  HREF="node97.html#SECTION06210030000000000000">app.js</A>
<LI><A NAME="tex2html2735"
  HREF="node97.html#SECTION06210040000000000000">The Structure</A>
<LI><A NAME="tex2html2736"
  HREF="node97.html#SECTION06210050000000000000">Running</A>
<LI><A NAME="tex2html2737"
  HREF="node97.html#SECTION06210060000000000000">El módulo debug</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION06210000000000000000">
Getting Started</A>
</H1>
This is a tutorial on using 

<UL>
<LI>node.js, 
</LI>
<LI>coffeescript and 
</LI>
<LI>mongodb 
</LI>
</UL>
to build a simple blog. 

<P>
Quite obviously, you’re going to need node.js and mongodb installed. I
recommend downloading and installing from the node.js website and
following the instructions. 

<P>
I will note that this tutorial covers 
<PRE>
[~/local/src/coffee]$ express --version
4.11.2
</PRE>
so
if you come across this post a year from now (2015) the API might have changed
significantly since then. 

<P>
You will also need mongodb installed.

<P>

<UL>
<LI>If you use Ubuntu (or some other Debian derivative)
you should consider installing from their apt repository. 

<P>
</LI>
<LI>OSX? No problem,
you can also install it via homebrew.
</LI>
</UL>

<P>
Finally, since we’ll be using coffeescript for this tutorial,
run 
<PRE>
[~/local/src/coffee]$ npm install -g coffee-script
npm http GET https://registry.npmjs.org/coffee-script
npm http 200 https://registry.npmjs.org/coffee-script
/usr/local/bin/coffee -&gt; /usr/local/lib/node_modules/coffee-script/bin/coffee
/usr/local/bin/cake -&gt; /usr/local/lib/node_modules/coffee-script/bin/cake
coffee-script@1.9.1 /usr/local/lib/node_modules/coffee-script
[~/local/src/coffee]$ coffee --version
CoffeeScript version 1.9.1
</PRE>
(you might need to sudo) to install
coffeescript. 

<P>
Run coffee from the commandline to access the coffeescript
REPL. If all works well, install these additional packages listed below
via npm that we’ll be using throughout the tutorial.

<P>

<UL>
<LI>express
</LI>
<LI>mocha. 
Véase la sección <I>Pruebas: Mocha y Chai</I>
<A HREF="node9.html#parrafo:mochaychai">1.2</A>
</LI>
</UL>

<P>

<H4><A NAME="SECTION06210010000000000000">
Express generator</A>
</H4>
  

<P>
Now let’s bootstrap our project structure. Type 
<PRE>
express coffeepress
</PRE>
to generate a skeleton express project structure. 
<PRE>
[~/local/src/coffee]$ express coffeepress

   create : coffeepress
   create : coffeepress/package.json
   create : coffeepress/app.js
   create : coffeepress/public
   create : coffeepress/public/images
   create : coffeepress/public/javascripts
   create : coffeepress/public/stylesheets
   create : coffeepress/public/stylesheets/style.css
   create : coffeepress/routes
   create : coffeepress/routes/index.js
   create : coffeepress/routes/users.js
   create : coffeepress/views
   create : coffeepress/views/index.jade
   create : coffeepress/views/layout.jade
   create : coffeepress/views/error.jade
   create : coffeepress/bin
   create : coffeepress/bin/www

   install dependencies:
     $ cd coffeepress &amp;&amp; npm install

   run the app:
     $ DEBUG=coffeepress:* ./bin/www
</PRE>

<P>
You should see output similar to the following:
<PRE>
[~/local/src/coffee]$ cd coffeepress
[~/local/src/coffee/coffeepress]$ tree
.
|--- app.js
|--- bin
|   `-- www
|--- package.json
|--- public
|   |--- images
|   |--- javascripts
|   `-- stylesheets
|       `-- style.css
|--- routes
|   |--- index.js
|   `-- users.js
`-- views
    |--- error.jade
    |--- index.jade
    `-- layout.jade

7 directories, 9 files
</PRE>

<P>
This is called <A NAME="11499"></A><SPAN  CLASS="textbf">Scaffolding</SPAN>.

<P>
The idea is simple: most projects
require a certain amount of so-called 
<FONT COLOR="#ff0000"> boilerplate</FONT> code, and who
wants to recreate that code every time you begin a new project? A simple
way is to create a rough skeleton of a project, and every time you need
a new project, you just copy this skeleton, or template.

<P>
Express has taken a page from Ruby on Rails and provided a utility to
generate scaffolding to start your Express project.

<P>

<H4><A NAME="SECTION06210020000000000000">
package.json</A>
</H4>
  

<P>
The <code>package.json</code> file is automatically populated with 

<UL>
<LI>the name of the application, 
</LI>
<LI>the dependencies, 
</LI>
<LI>the private attribute: If you set <code>"private": true</code> in your 
<code>package.json</code>, then <code>npm</code> will refuse to publish it.  
This is a way to prevent accidental publication of private repositories.
</LI>
<LI>the starting script. 
</LI>
</UL>
<PRE>
[/tmp/coffeepress]$ cat package.json 
{
  "name": "coffeepress",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "start": "node ./bin/www"
  },
  "dependencies": {
    "body-parser": "~1.10.2",
    "cookie-parser": "~1.3.3",
    "debug": "~2.1.1",
    "express": "~4.11.1",
    "jade": "~1.9.1",
    "morgan": "~1.5.1",
    "serve-favicon": "~2.2.0"
  }
</PRE>

<UL>
<LI>The module
<A NAME="tex2html401"
  HREF="https://github.com/expressjs/body-parser">body-parser</A>
provides a boyd parsing middleware
</LI>
<LI>The module
<A NAME="tex2html402"
  HREF="https://github.com/expressjs/cookie-parser">cookie-parser</A>
parses the Cookie header and populate <code>req.cookies</code> 
with an object keyed by the cookie names. 

<P>
</LI>
<LI>The 
<A NAME="tex2html403"
  HREF="https://github.com/expressjs/morgan">morgan</A>
module provides a HTTP request logger middleware.
</LI>
<LI>The
<A NAME="tex2html404"
  HREF="https://github.com/expressjs/serve-favicon">serve-favicon</A>
module provides a middleware for serving a favicon
</LI>
</UL>

<P>
The starting script is <code>bin/www</code> which  loads <code>app.js</code> 
<PRE>
[/tmp/coffeepress]$ cat bin/www 
#!/usr/bin/env node

/**
 * Module dependencies.
 */

var app = require('../app');
var debug = require('debug')('coffeepress:server');
var http = require('http');

/**
 * Get port from environment and store in Express.
 */

var port = normalizePort(process.env.PORT || '3000');
app.set('port', port);

/**
 * Create HTTP server.
 */

var server = http.createServer(app);

/**
 * Listen on provided port, on all network interfaces.
 */

server.listen(port);
server.on('error', onError);
server.on('listening', onListening);

/**
 * Normalize a port into a number, string, or false.
 */

function normalizePort(val) {
  var port = parseInt(val, 10);

  if (isNaN(port)) {
    // named pipe
    return val;
  }

  if (port &gt;= 0) {
    // port number
    return port;
  }

  return false;
}

/**
 * Event listener for HTTP server "error" event.
 */

function onError(error) {
  if (error.syscall !== 'listen') {
    throw error;
  }

  var bind = typeof port === 'string'
    ? 'Pipe ' + port
    : 'Port ' + port

  // handle specific listen errors with friendly messages
  switch (error.code) {
    case 'EACCES':
      console.error(bind + ' requires elevated privileges');
      process.exit(1);
      break;
    case 'EADDRINUSE':
      console.error(bind + ' is already in use');
      process.exit(1);
      break;
    default:
      throw error;
  }
}

/**
 * Event listener for HTTP server "listening" event.
 */

function onListening() {
  var addr = server.address();
  var bind = typeof addr === 'string'
    ? 'pipe ' + addr
    : 'port ' + addr.port;
  debug('Listening on ' + bind);
}
</PRE>

<P>

<H4><A NAME="SECTION06210030000000000000">
app.js</A>
</H4>
  

<P>
<code>app.js</code> loads the middleware, assigns the route handlers, and starts the server. 

<P>

<H4><A NAME="SECTION06210040000000000000">
The Structure</A>
</H4>
  

<P>
There are three folders in the root:

<UL>
<LI>public: This folder contains the static assets
<PRE>
|--- public
|   |--- images
|   |--- javascripts
|   `-- stylesheets
|       `-- style.css
</PRE>
</LI>
<LI>views: This folder is populated with Jade templates by default
<PRE>
| 
`-- views
    |--- error.jade
    |--- index.jade
    `-- layout.jade
</PRE>
</LI>
<LI>routes: This folder includes the routes (these are the equivalent controllers)
<PRE>
|
|--- routes
|   |--- index.js
|   `-- users.js
</PRE>
</LI>
</UL>
Apart from these existing folders and the models folder, which we need to create ourselves, we might also create folders for 

<UL>
<LI>tests, 
</LI>
<LI>logs, or 
</LI>
<LI>configuration. 
</LI>
</UL>

<P>
The best thing about this structure is that
it's easy to get started with and is known to most developers.

<P>
<PRE>
[~/src/coffee]$ express --help

  Usage: express [options] [dir]

  Options:

    -h, --help          output usage information
    -V, --version       output the version number
    -e, --ejs           add ejs engine support (defaults to jade)
        --hbs           add handlebars engine support
    -H, --hogan         add hogan.js engine support
    -c, --css &lt;engine&gt;  add stylesheet &lt;engine&gt; support (less|stylus|compass) (defaults to plain css)
        --git           add .gitignore
    -f, --force         force on non-empty directory
</PRE>
Boilerplate is also useful for the actual HTML that will be delivered to the client. See 
for example  
<A NAME="tex2html405"
  HREF="https://html5boilerplate.com/">https://html5boilerplate.com/</A>.

<P>

<H4><A NAME="SECTION06210050000000000000">
Running</A>
</H4>
  

<P>
Instalamos las dependencias:
<PRE>
[~/src/coffee/coffeepress]$ npm install
npm http GET https://registry.npmjs.org/jade
....
</PRE>
y ejecutamos:
<PRE>
~/src/coffee/coffeepress]$ DEBUG=coffeepress:* ./bin/www
  coffeepress:server Listening on port 3000 +0ms
</PRE>
Then load <code>http://localhost:3000/</code> in your browser to access the app.

<P>

<H4><A NAME="SECTION06210060000000000000">
El módulo debug</A>
</H4>
  

<P>
El generador de Express nos produjo el fichero <code>bin/www</code>.
Este programa hace uso del módulo 
<A NAME="tex2html406"
  HREF="https://github.com/visionmedia/debug">debug</A>
que es el que nos permite emitir el mensaje de <code>Listening on</code>:
<PRE>
[~/src/coffee/coffeepress(master)]$ grep debug bin/www.coffee 
debug = require('debug')('coffeepress:server')
  debug 'Listening on ' + bind
</PRE>
La primera línea <code>debug = require('debug')('coffeepress:server')</code> carga la librería
y establece el nombre de <code>www.coffee</code> a efectos de depuración como
<code>coffeepress:server</code>.

<P>
The <code>DEBUG</code> environment variable must be set to a list of file names
separated by commas or spaces. It is then used to enable these 
<code>debug('...')</code> messages. 

<P>
Por ejemplo:
<PRE>
DEBUG=coffeepress:* bin/www
</PRE>
dice que se activan los mensajes de debug en cualquier fichero con 
prefijo de nombre <code>coffeepress</code>.

<P>

<DIV CLASS="navigation"><HR>
<A NAME="tex2html2730"
  HREF="node98.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2724"
  HREF="node96.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2718"
  HREF="node96.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2726"
  HREF="node100.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2728"
  HREF="node103.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/perlexamples/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="Apuntes de LPP"></A><A NAME="tex2html3"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5669"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2014/2015"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2013/2014"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="https://plus.google.com/u/0/communities/103299470687051533933"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1415"></A><A NAME="tex2html7"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html8"
  HREF="http://www.ull.es/view/centros/etsii/Grado_en_Ingenieria_Informatica/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html9"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html10"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2731"
  HREF="node98.html">Porting to Coffeescript</A>
<B>Sup:</B> <A NAME="tex2html2725"
  HREF="node96.html">CoffeeScript y Express</A>
<B> Ant:</B> <A NAME="tex2html2719"
  HREF="node96.html">CoffeeScript y Express</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2015-04-08</I>
</ADDRESS>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Mongoose</TITLE>
<META NAME="description" CONTENT="Mongoose">
<META NAME="keywords" CONTENT="javascriptexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node100.html">
<LINK REL="previous" HREF="node98.html">
<LINK REL="up" HREF="node94.html">
<LINK REL="next" HREF="node100.html">
</HEAD>

<BODY >

<DIV CLASS="navigation">
<A NAME="tex2html2974"
  HREF="node100.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2968"
  HREF="node94.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2962"
  HREF="node98.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2970"
  HREF="node101.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2972"
  HREF="node104.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/perlexamples/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="Apuntes de LPP"></A><A NAME="tex2html3"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5669"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2014/2015"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2013/2014"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="https://plus.google.com/u/0/communities/103299470687051533933"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1415"></A><A NAME="tex2html7"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html8"
  HREF="http://www.ull.es/view/centros/etsii/Grado_en_Ingenieria_Informatica/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html9"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html10"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2975"
  HREF="node100.html">Añadiendo Persistencia: Posts con</A>
<B>Sup:</B> <A NAME="tex2html2969"
  HREF="node94.html">CoffeeScript y Express</A>
<B> Ant:</B> <A NAME="tex2html2963"
  HREF="node98.html">MongoDB</A>
<B> Con:</B> 
<A NAME="tex2html2970"
  HREF="node101.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>
<B> Ind:</B> 
<A NAME="tex2html2972"
  HREF="node104.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html2976"
  HREF="node99.html#SECTION06251000000000000000">Getting Started</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION06250000000000000000">
Mongoose</A>
</H1>

<P>
<A NAME="tex2html435"
  HREF="http://mongoosejs.com/">Mongoose</A>
provides a straight-forward, schema-based solution to modeling your
application data and includes built-in type casting, validation, query
building, business logic hooks and more, out of the box.

<P>

<H2><A NAME="SECTION06251000000000000000">
Getting Started</A>
</H2>

<P>
Véase
<A NAME="tex2html436"
  HREF="http://mongoosejs.com/docs/index.html">mongoose: getting started</A>.

<P>
Now say we like fuzzy kittens and want to record every kitten we ever
meet in MongoDB. 

<P>
The first thing we need to do is include mongoose in
our project and open a connection to the test database on
our locally running instance of MongoDB.

<P>
<PRE>
// getting-started.js
var mongoose = require('mongoose');
mongoose.connect('mongodb://localhost/test');
</PRE>

<P>
We have a pending connection to the test database running on localhost. We
now need to get notified if we connect successfully or if a connection
error occurs:

<P>
<PRE>
var db = mongoose.connection;
db.on('error', console.error.bind(console, 'connection error:'));
db.once('open', function (callback) {
  // yay!
});
</PRE>

<P>
Once our connection opens, our callback will be called. 

<P>

<FONT COLOR="#ff0000"> For brevity, let's assume that all following code is within this callback</FONT>.

<P>
With Mongoose, everything is derived from a 
<code>Schema</code>. 

<P>
Let's get a reference to it and define our kittens.

<P>
<PRE>
var kittySchema = mongoose.Schema({
    name: String
})
</PRE>
Everything in Mongoose starts with a 
<A NAME="tex2html437"
  HREF="http://mongoosejs.com/docs/guide.html">Schema</A>. 
Each schema maps to a <A NAME="12829"></A><SPAN  CLASS="textbf">MongoDB</SPAN> collection and 
<FONT COLOR="#ff0000"> defines the shape of the <A NAME="12834"></A><SPAN  CLASS="textbf">MongoDB documents</SPAN> within that collection</FONT>.

<P>
So far so good. 

<P>
We've got a schema with one property, <code>name</code>, which will be a <code>String</code>. 

<P>
The next step is compiling our schema into a 
<A NAME="tex2html438"
  HREF="http://mongoosejs.com/docs/models.html">Model</A>.

<P>
<PRE>
var Kitten = mongoose.model('Kitten', kittySchema)
</PRE>

<FONT COLOR="#ff0000"> A model is a class with which we construct documents</FONT>. 

<P>
In this case, each document will be a kitten with properties and behaviors as declared in our schema. 
Let's create a kitten document representing the little guy we just met on the sidewalk outside:
<PRE>
var silence = new Kitten({ name: 'Silence' })
console.log(silence.name) // 'Silence'
</PRE>

<P>
Kittens can meow, so let's take a look at how to add "speak" functionality to our documents:

<P>

<FONT COLOR="#ff0000"> methods must be added to the schema before compiling it with</FONT> <code>mongoose.model()</code>
<PRE>
kittySchema.methods.speak = function () {
  var greeting = this.name
    ? "Meow name is " + this.name
    : "I don't have a name"
  console.log(greeting);
}

var Kitten = mongoose.model('Kitten', kittySchema)
</PRE>
Functions added to the methods property of a schema get compiled into
the Model prototype and exposed on each document instance:
<PRE>
var fluffy = new Kitten({ name: 'fluffy' });
fluffy.speak()
</PRE>

<P>
We have talking kittens! But we still haven't saved anything to
MongoDB. 

<P>
Each document can be saved to the database by calling its
<code>save</code> method. 

<P>
The first argument to the callback will be an error if
any occured.

<P>
<PRE>
fluffy.save(function (err, fluffy) {
  if (err) return console.error(err);
  fluffy.speak();
});
</PRE>

<P>
Say time goes by and we want to display all the kittens we've seen. 

<P>
We can access all of the kitten documents through our <code>Kitten</code> model.

<P>
<PRE>
Kitten.find(function (err, kittens) {
  if (err) return console.error(err);
  console.log(kittens)
})
</PRE>

<P>
We just logged all of the kittens in our <code>db</code> to the console. 

<P>
If we want to filter our kittens by name, Mongoose supports MongoDBs rich querying syntax.

<P>
<PRE>
Kitten.find({ name: /^Fluff/ }, callback)
</PRE>
This performs a search for all documents with a name property that begins with <code>"Fluff"</code> 
and returns the result as an array of kittens to the <code>callback</code>.

<P>
Este es el código completo de nuestro ejemplo:

<P>
<PRE>
[~/javascript/mongoose]$ cat getting-started.js 
var mongoose = require('mongoose');
mongoose.connect('mongodb://localhost/test');

var kittySchema = mongoose.Schema({
    name: String
  });


kittySchema.methods.speak = function() {
  var greeting = this.name? "Meow name is "+this.name : "I don't have a name";
  console.log(greeting);

}

// compiling our schema into a Model
var Kitten = mongoose.model('Kitten', kittySchema);

var db = mongoose.connection;
db.on('error', console.error.bind(console, 'Error en la conexión a MongoDB:'));

var errDisconnect =  function(err) {
  if (err) { console.log("Se produjo un error en la desconexión! "+err) }
  else { console.log("Desconectando!") }
}

var main = function() {
  console.log("Abierta la conexión con MongoDB!");

  var silence = new Kitten({ name: 'Silence' });
  console.log(silence.name);    // 'Silence'
  silence.speak(); // 'Meow name is Silence'

  var fluffy = new Kitten({ name: 'fluffy' });
  fluffy.speak();

  fluffy.save(function (err, fluffy) {
    if (err) console.error("no puedo guardar a fluffy! "+err)
    else console.error("fluffy guardado!");

    Kitten.find({ name: /^Fluff/i },function (err, kittens) {
      if (err) return console.error("Error buscando gatos! "+err);
      console.log(kittens);

      mongoose.disconnect(errDisconnect);
    });
  });
}

db.once('open', main);
</PRE>
Cuando lo ejecutamos obtenemos:
<PRE>
[~/javascript/mongoose]$ node getting-started.js 
Abierta la conexión con MongoDB!
Silence
Meow name is Silence
Meow name is fluffy
fluffy guardado!
[ { _id: 552fb8f77e6de9990a4e6747, name: 'fluffy', __v: 0 } ]
Desconectando!
</PRE>
Si lo ejecutamos una segunda vez obtenemos:
<PRE>
[~/javascript/mongoose]$ node getting-started.js 
Abierta la conexión con MongoDB!
Silence
Meow name is Silence
Meow name is fluffy
fluffy guardado!
[ { _id: 552fb8f77e6de9990a4e6747, name: 'fluffy', __v: 0 },
  { _id: 552fb8f987df0fa30ab92647, name: 'fluffy', __v: 0 } ]
Desconectando!
</PRE>

<P>

<DIV CLASS="navigation"><HR>
<A NAME="tex2html2974"
  HREF="node100.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2968"
  HREF="node94.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2962"
  HREF="node98.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2970"
  HREF="node101.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2972"
  HREF="node104.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/perlexamples/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="Apuntes de LPP"></A><A NAME="tex2html3"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5669"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2014/2015"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2013/2014"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="https://plus.google.com/u/0/communities/103299470687051533933"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1415"></A><A NAME="tex2html7"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html8"
  HREF="http://www.ull.es/view/centros/etsii/Grado_en_Ingenieria_Informatica/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html9"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html10"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2975"
  HREF="node100.html">Añadiendo Persistencia: Posts con</A>
<B>Sup:</B> <A NAME="tex2html2969"
  HREF="node94.html">CoffeeScript y Express</A>
<B> Ant:</B> <A NAME="tex2html2963"
  HREF="node98.html">MongoDB</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2016-02-14</I>
</ADDRESS>
</BODY>
</HTML>
